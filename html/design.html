<!doctype html>
<html lang="en">
    <head>
        <title>
            Design - Demodulator and Audio Amplifier
        </title>
        
        <link rel="icon" href="media/icons/wave.png">

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta content="Demodulator and Audio Amplifier" property="og:title">
        <meta content="ECE295: Hardware Design and Communication @ UofT" property="og:description">
        <meta content="Sam Chowdhury's" property="og:site_name">
        <meta content='https://samn-c.github.io/demodulator/media/special/backSmall.png' property='og:image'>
        <meta name="theme-color" content="#EF6461">

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
        <link rel="stylesheet" href="css/style.css">
    </head>

    <body>
        <a id="top"></a>

        <div class="row nonstick whiteback">
            <div class="col-sm-12 textdivmargin divpad">
                <h1>
                    Demodulator and Audio Amplifier
                </h1>

                <h2 class="primary">
                    ECE295: Hardware Design and Communication at UofT
                </h2>
            </div>
        </div>

        <nav class="navbar navbar-expand-sm navbar-dark sticky-top">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="../index.html">Home</a>
                </li>
            </ul>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-end" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="design.html">Design</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="prototype.html">Prototype</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="assembly.html">Assembly</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="testing.html">Testing</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">About</a>
                    </li>
                </ul>
            </div>
        </nav>

        <div class="main">
            <!-- preface -->
            <div class="row sback">
                <div class="col-sm-2 nopad"></div>

                <div class="col-sm-6 divpad textdivmargin">
                    <h1 class="center textpad">
                        Design
                    </h1>

                    <h2 class="center textpad">
                        Preface
                    </h2>

                    <p class="justify textpad">
                        To prevent future students from copying my design 
                        (and to avoid an appearance before the UofT Tribunal 
                        for an academic offence), 
                        all circuit element values and calculations are omitted from 
                        this website. 
                        
                        <br><br>
                        If you are curious to see the design files and 
                        calculations, 
                        
                        <a href="https://samn.ca" target="_blank">
                            contact me <img src="media/icons/exit.png">
                        </a>

                        directly :)
                    </p>
                </div>
                
                <div class="col-sm-3 nopad textdivmargin">
                    <h2 class="center textpad toppad">
                        Jump to
                    </h2>
                    
                    <p class="center textpad toppad">
                        <a class="btn" href="#rev1">1st Revision</a>
                    </p>
                    
                    <p class="center textpad toppad">
                        <a class="btn" href="#rev2">2nd Revision</a>
                    </p>
                    
                    <p class="center textpad toppad botpad">
                        <a class="btn" href="#pcb">PCB Design</a>
                    </p>
                </div>
            </div>
            
            <!-- requirements -->
            <div class="row pback">
                <div class="col-sm-12 nopad">
                    <div class="row">
                        <div class="col-sm-6 divpad textdivmargin">
                            <h2 class="center textpad">
                                Subsystem C: Design Requirements
                            </h2>

                            <p class="justify textpad">
                                The following is a list of requirements that our design
                                had to meet. We had to interface with Subsystem B and the 
                                board also had to fit within set dimensions to be placed on the 
                                SDR motherboard.
                            </p>
                        </div>

                        <div class="col-sm-6 nopad textdivmargin">
                            <img class="imgfull" src="media/design/295SDR.png">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6 textdivmargin divpad">
                            <ul>
                                <br>
                                
                                <li>
                                    2 input signals: Baseband I (in-phase) and Q (quadrature) signals from Subsystem B
                                </li>

                                <br>
                                
                                <li>
                                    AM input signal specification: 40 - 100kHz carrier frequency, 20Hz - 3kHz message signal
                                </li>

                                <br>

                                <li>
                                    SSB input signal specification: 2 - 3kHz carrier frequency, 0 - 3kHz message signal
                                </li>

                                <br>

                                <li>
                                    1 duplicated output signal for two 8&#8486; speakers (mono)
                                </li>

                                <br>

                                <li>
                                    Switching between AM and Single-Sideband (SSB) Demodulation + volume control
                                </li>

                                <br>

                                <li>
                                    SSB phase specification: I and Q must be set 90&#176; &plusmn; 12.5&#176; apart
                                </li>
                            </ul>
                        </div>
                        
                        <div class="col-sm-6 nopad textdivmargin">
                            <img class="imgfull" src="media/design/requirements.png">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6 nopad textdivmargin">
                            <img class="imgfull" src="media/design/mechanical.png">
                        </div>

                        <div class="col-sm-6 textdivmargin divpad">
                            <h2 class="textpad">
                                What does it all mean?
                            </h2>

                            <p class="justify textpad">
                                Honestly, most of these requirements didn't make sense when I saw
                                them for the first time. Later on, I realized that a lot of the concepts
                                we'd apply to our designs were actually taught in third-year, 
                                but the teaching team helped us learn
                                quickly enough to design our board.

                                <br><br>

                                That help came after the first design review, where we learned just how
                                much was wrong with our first design.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- first revision -->
            <a id="rev1"></a>
            <div class="row sback">
                <div class="col-sm-3 textdivmargin divpad">
                    
                    <h2 class="textpad">
                        First Revision
                    </h2>

                    <p class="justify textpad">
                        I know this is a lot to look at initially, but I wanted to show how disorganized
                        our first revision was because we put everything on the same schematic. Right off 
                        the bat, there were two mistakes, but we wrung out almost all of our issues by the second 
                        design review.
                    </p>
                </div>

                <div class="col-sm-9 nopad">
                    <img class="imgfull" src="media/design/firstSchematic.jpg">  
                </div>
            </div>

            <!-- op-amp issue -->
            <div class="row pback">
                <div class="col-sm-12 divpad nopad">
                    <h2 class="center textpad">
                        SSB Demodulator - The First Problem
                    </h2>

                    <p class="center textpad botpad">
                        Multisim Outputs: Red - In-Phase, Green - Quadrature, Blue - Summed Audio Output
                    </p>

                    <img class="imgfull" src="media/design/firstSSB.jpg">  

                    <div class="row">
                        <div class="col-sm-3"></div>

                        <div class="col-sm-6 toppad">
                            <p class="justify textpad">
                                Before moving into what's wrong with this design, I'd like to mention one thing we
                                did right&#8212;op-amp biasing. The motherboard only supplied us with 5V and GND 
                                terminals, meaning our signals had to be centred at 2.5V to make use of the op-amps.
                                If you look at the C1-R1-R2, C3-R7-R8 and C4-R11-R12 combinations, they centre the
                                input signals and the op-amp positive terminal in U1B. We made sure the cut-off frequency
                                of the resistor and capacitor combinations was high enough to allow our signals to pass 
                                through.

                                <br><br>

                                As for the problem, it has to do with the first op-amp. In SSB Demodulation, the
                                I and Q signals are shifted 90 degrees apart and then added together.
                                This gives us an audio signal at the output terminal of the second op-amp. The first op-amp
                                is an All-Pass Filter (APF) that shifts the Q signal by 90 degrees, and the second op-amp is
                                a Summing Amplifier that adds the two signals together. 
                                
                                <br><br>

                                The issue was that the APF only shifted 10kHz signals by 90 degrees, rather than a 
                                range of frequencies. Even if the SSB signal was centred at 10kHz, the message signal (audio)
                                ranges from 0 - 3kHz on top of that, which would have given us an improper phase shift.
                                The summing was done right, even though it's an inverted (audio) signal. Audio can be upside 
                                down, or you'd hear something different when you put your headphones on upside-down. 
                            </p>
                        </div>
                    </div>
                </div>
            </div>    
            
            <!-- AM is fine -->
            <div class="row sback">
                <div class="col-sm-12 divpad nopad">
                    <h2 class="center textpad">
                        AM Demodulator - No Issues
                    </h2>

                    <p class="center textpad botpad">
                        Multisim Outputs: Red - AM Signal, Green - Envelope, Blue - Audio Output
                    </p>

                    <img class="imgfull" src="media/design/firstAM.jpg">  

                    <div class="row">
                        <div class="col-sm-3"></div>

                        <div class="col-sm-6 toppad">
                            <p class="justify textpad">
                                In AM Demodulation, the Amplitude-Modulated (AM) signal is first passed through an 
                                Envelope detector which traces the amplitude of the signal with less perturbation.
                                Then that signal passes through a Band-Pass Filter (BPF) which further smoothens out the signal,
                                leaving us with a filtered audio signal. There's a formula for the R13-C5 combination that we 
                                used to make sure it optimally envelopes the 40kHz - 100kHz AM signal. 

                                <br><br>

                                The C7-R15-R16 combination was to bias the signal at 2.5V, to centre it for the op-amps
                                ahead of it (which were ultimately redundant, scroll down to read more). Typically an
                                AM Demodulator has only a Low-Pass Filter, but the biasing turned it into a BPF in our initial
                                design.
                            </p>
                        </div>
                    </div>
                </div>
            </div>  
            
            <!-- UGB and Audio Amplfier issue -->
            <div class="row pback">
                <div class="col-sm-12 divpad nopad">
                    <h2 class="center textpad botpad">
                        Unity Gain Buffers and Audio Amplifiers - The Second Problem
                    </h2>

                    <img class="imgfull" src="media/design/firstAA.jpg">  

                    <div class="row">
                        <div class="col-sm-3"></div>

                        <div class="col-sm-6 toppad">
                            <p class="justify textpad">
                                We thought we'd need Unity Gain Buffers (UGB) to duplicate the audio signal without loss.
                                We were wrong. Turns out a single audio amplifier chip was enough to amplify the 
                                signal for both left and right audio channels (there's adequate impedance at the input and 
                                output terminals of the chip), so we were able to remove 75% of the
                                components in this part of the design. The UGBs weren't AC coupled with a capacitor to the
                                audio amplifier chips, so that was another issue we overlooked in our first iteration.
                            </p>
                        </div>
                    </div>
                </div>
            </div>   

            <!-- second revision -->
            <a id="rev2"></a>
            <div class="row sback">
                <div class="col-sm-3 textdivmargin divpad">
                    
                    <h2 class="textpad">
                        Second Revision
                    </h2>

                    <p class="justify textpad">
                        A few weeks later, we had our second design review. We showcased an organized
                        design for our board to the teaching team which had far fewer issues. We added
                        a test point between the demodulators and the audio amplifier, which is the perfect 
                        point to test all three systems independently with a single reference point. We 
                        also implemented an LED indicator light to avoid having to check for power every
                        time we tested the circuit.
                    </p>
                </div>

                <div class="col-sm-9 nopad textdivmargin">
                    <img class="imgfull" src="media/design/topLevelSchematic.jpg">  
                </div>
            </div>
            
            <!-- New SSB -->
            <div class="row pback">
                <div class="col-sm-12 nopad">
                    <h2 class="center divpad textpad">
                        The Improved SSB Demodulator
                    </h2>

                    <img class="imgfull" src="media/design/SSBSchematic.jpg">  

                    <div class="row">
                        <div class="col-sm-6 divpad textdivmargin">
                            <p class="justify textpad">
                                This time a chain of three APFs for both input signals was used. We
                                found a reference design that was provided by the TA to help us choose our
                                element values, which creates a clean range of 90-degree phase shifting between
                                250Hz to 3.6kHz as you can see in the output graph. The Summing Amplifier was 
                                not modified.
                            </p>
                        </div>

                        <div class="col-sm-6 textdivmargin nopad">
                            <img class="imgfull" src="media/design/SSBOutput.png">
                        </div>
                    </div>
                </div>
            </div>   
            
            <!-- New AM Demod -->
            <div class="row sback">
                <div class="col-sm-12 divpad nopad">
                    <h2 class="center textpad botpad">
                        Modifying the AM Demodulator
                    </h2>

                    <img class="imgfull" src="media/design/AMSchematic.jpg">  

                    <div class="row">
                        <div class="col-sm-3"></div>

                        <div class="col-sm-6 toppad">
                            <p class="justify textpad">
                                Not much changed here apart from removing the 2.5V biasing, since we didn't
                                have UGBs anymore. We tweaked the RC values a little to optimize more for 
                                a 0 - 3kHz message signal.
                            </p>
                        </div>
                    </div>
                </div>
            </div>   
                        
            <!-- New Audio -->
            <div class="row pback">
                <div class="col-sm-12 nopad">
                    <h2 class="center divpad textpad">
                        The Simplified Audio Amplifier
                    </h2>

                    <img class="imgfull" src="media/design/audioAmpSchematic.jpg">  

                    <div class="row">
                        <div class="col-sm-6 divpad textdivmargin">
                            <p class="justify textpad">
                                Since the second Audio Amplifier and the UGBs had been removed,
                                the design became a lot simpler. We also added C11, which AC couples the demodulators
                                (mainly the SSB since it is sending a signal biased to 2.5V) to the amplifier.

                                <br><br>

                                We had a minor issue with this design which was never solved. Since we only had
                                a 5V supply, the amplifier would clip the audio if we set the volume too high with the 
                                potentiometer. Ultimately we used a higher resistance potentiometer which made our
                                design capable of 65% volume before clipping.
                            </p>
                        </div>
                        
                        <div class="col-sm-6 nopad fill">
                            <img class="imgfull" src="media/design/audioAmpOut.png">
                        </div>
                    </div>
                </div>
            </div>   

            <!-- PCB Design -->
            <a id="pcb"></a>
            <div class="row sback">

                <div class="col-sm-4 row">
                    <div class="col nopad textdivmargin">
                        <img class="imgfull" src="media/design/3dView.jpg">
                    </div>

                    <div class="col nopad textdivmargin">
                        <img class="imgfull" src="media/design/3dViewBack.jpg">
                    </div>
                </div>
                
                <div class="col-sm-4 textdivmargin divpad nopad">
                    <h2 class="textpad">
                        PCB Design
                    </h2>

                    <p class="justify textpad">
                        A week after the second design review, our PCB Designs were due for review
                        (as well as circuit reviews for teams that needed to tweak their design more).
                        It was challenging to fit everything on such a small board, so I spent
                        the entire week avoiding my other courses to arrange our design as best as 
                        possible and ordering parts. I could have chosen to place all the resistors in a 
                        hairpin style, but I wanted to make sure our design followed good practices. It 
                        was also my favourite part of the project and I was very satisfied with the 
                        PCB arrangement :)

                        <br><br>

                        The subcircuits are distinguishable on the board. The five elements connected at the top
                        make up the AM Demodulator, and beneath it is the LED indicator. Then most of the board
                        is taken up by the SSB Demodulator (elements connected to U1 - U4). You can see both the 
                        demodulator outputs connected to S1 near the bottom right, right next to the J1 test point.
                        Lastly, at the bottom of the board, is the Audio Amplifier.

                        <br><br>

                        All signal traces were on the top plane (red), while the 5V power signal was on the bottom plane (blue).
                        In terms of good practice, I also placed ground planes on both the top and bottom.
                        We didn't go into the details of EM shielding, but for safe measure, I added via stitching between
                        the two ground planes. 
                    </p>
                </div>
                
                <div class="col-sm-4 row">
                    <div class="col nopad textdivmargin">
                        <img class="imgfull" src="media/design/frontTrace.jpg">
                    </div>

                    <div class="col nopad textdivmargin">
                        <img class="imgfull" src="media/design/backTrace.jpg">
                    </div>
                </div>
            </div>   

            <!-- footprints -->
            <div class="row pback">
                <div class="col-sm-4 divpad textdivmargin">
                    <h2 class="textpad">
                        Designing Footprints
                    </h2>

                    <p class="justify textpad">
                        Our volume potentiometer, audio output capacitor and SPDT switch didn't have
                        footprints available online, so I made their footprints myself following their
                        datasheets. In the case of the potentiometer, the datasheet didn't clearly  
                        specify which turn direction increased the resistance between pin 2 and 3, so I included
                        two pin 2 nets in the footprint so that I could flip the potentiometer to achieve a clockwise
                        volume increase. Once the potentiometer arrived, we determined that the correct position
                        for clockwise volume increase (or resistance decrease) was to use the top pin 2 position.
                    </p>
                </div>

                <div class="col-sm-8 nopad">
                    <img class="imgfull" src="media/design/footprints.jpg">
                </div>
            </div>

            <!-- the end of design -->
            <div class="row sback">
                <div class="col-sm-3"></div>

                <div class="col-sm-6 divpad">
                    <h2 class="center textpad">
                        What next?
                    </h2>

                    <p class="justify textpad">
                        Once we double checked that we passed both the ERC and DRC, the PCB was ready to be manufactured.
                        It took nearly a month for the boards to arrive, but in the meantime, we
                        tested a prototype of our design. Even though prototyping was not 
                        mandatory for the project, it was a necessary step to check for issues in case our
                        PCB didn't work on the first attempt.
                    </p>
                </div>
            </div>

            <!-- jump to section -->
            <div class="row pback">
                <div class="col-sm-3 textpad divpad center">
                    <a href="design.html">
                        <img src="media/icons/design.png">

                        <h1>
                            Design
                        </h1>

                        <img src="media/icons/up.png">

                        <p class="center">
                            <br>
                            You are currently on the design page.
                        </p>
                    </a>
                </div>

                <div class="col-sm-3 textpad divpad center">
                    <a href="prototype.html">
                        <img src="media/icons/prototype.png">

                        <h1>
                            Prototype
                        </h1>
                        
                        <img src="media/icons/go2.png">

                        <p class="center">
                            <br>
                            Click here to see the breadboard phase.
                        </p>
                    </a>
                </div>
                
                <div class="col-sm-3 textpad divpad center">
                    <a href="assembly.html">
                        <img src="media/icons/assembly.png">

                        <h1>
                            Assembly
                        </h1>

                        <img src="media/icons/go2.png">

                        <p class="center">
                            <br>
                            Click here to see the assembly process and the final product.
                        </p>
                    </a>
                </div>
                
                <div class="col-sm-3 textpad divpad center">
                    <a href="testing.html">
                        <img src="media/icons/testing.png">
                        
                        <h1>
                            Testing
                        </h1>

                        <img src="media/icons/go2.png">

                        <p class="center">
                            <br>
                            Click here to see final testing results and output accuracy.
                        </p>
                    </a>
                </div>
            </div>
        </div>

        <div class="foot">
            <div class="row whiteback">
                <div class="col-sm-4 divpad textdivmargin">
                    <p class="center textpad">
                        Made by 
                        <a href="https://samn.ca" target="_blank">
                            Sam Chowdhury <img src="media/icons/exit2.png">
                        </a>
                    </p>
                </div>
                
                <div class="col-sm-4 divpad textdivmargin">
                    <p class="center textpad">
                        <a class="btn sbtn" href="#top">Back to top</a>
                    </p>
                </div>
                
                <div class="col-sm-4 divpad textdivmargin">
                    <p class="center textpad">
                        This website is not affiliated with the University of Toronto
                    </p>
                </div>
            </div>

            <div class="row blackback">
                <div class="col-sm-6 divpad textdivmargin">
                    <p class="center textpad">
                        &copy; Sam Chowdhury
                    </p>
                </div>

                <div class="col-sm-6 divpad textdivmargin">
                    <p class="center textpad">
                        Made with 
                        <a href="https://getbootstrap.com/" target="_blank">
                            Bootstrap <img src="media/icons/exit.png">
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </body>
</html>
